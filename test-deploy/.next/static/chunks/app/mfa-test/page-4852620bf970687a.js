(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[470],{285:(e,t,r)=>{"use strict";r.d(t,{$:()=>o});var a=r(5155);r(2115);var n=r(4624),s=r(2085),l=r(9434);let i=(0,s.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function o(e){let{className:t,variant:r,size:s,asChild:o=!1,...c}=e,d=o?n.DX:"button";return(0,a.jsx)(d,{"data-slot":"button",className:(0,l.cn)(i({variant:r,size:s,className:t})),...c})}},503:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var a=r(5155),n=r(2115),s=r(285),l=r(6695);let i=n.forwardRef((e,t)=>{let{className:r,type:n,...s}=e;return(0,a.jsx)("input",{type:n,className:"flex h-10 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(r||""),ref:t,...s})});i.displayName="Input",r(7650);var o=r(4624),c=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let r=(0,o.TL)(`Primitive.${t}`),s=n.forwardRef((e,n)=>{let{asChild:s,...l}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,a.jsx)(s?r:t,{...l,ref:n})});return s.displayName=`Primitive.${t}`,{...e,[t]:s}},{}),d=n.forwardRef((e,t)=>(0,a.jsx)(c.label,{...e,ref:t,onMouseDown:t=>{var r;t.target.closest("button, input, select, textarea")||(null==(r=e.onMouseDown)||r.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));d.displayName="Label";var u=r(2085),f=r(9434);let p=(0,u.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),m=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(d,{ref:t,className:(0,f.cn)(p(),r),...n})});function x(e){let{userId:t,onComplete:r}=e,[o,c]=(0,n.useState)("setup"),[d,u]=(0,n.useState)(""),[f,p]=(0,n.useState)(""),[x,h]=(0,n.useState)([]),[v,g]=(0,n.useState)(""),[b,y]=(0,n.useState)(!1),j="http://localhost:8000/api",w=(0,n.useCallback)(async()=>{try{y(!0);let e=await fetch("".concat(j,"/mfa/generate-secret"),{method:"POST"}),r=await e.json(),a=await fetch("".concat(j,"/mfa/generate-backup-codes"),{method:"POST"}),n=await a.json();if((await fetch("".concat(j,"/mfa/enable?user_id=").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({totp_secret:r.secret,backup_codes:n.backup_codes})})).ok){let e=await fetch("".concat(j,"/mfa/generate-qr/").concat(t)),r=await e.json();u(r.qr_code),p(r.secret),h(n.backup_codes),c("verify")}}catch(e){console.error("MFA設定エラー:",e)}finally{y(!1)}},[j,t]);(0,n.useEffect)(()=>{"setup"===o&&w()},[o,w]);let N=async()=>{try{y(!0),(await fetch("".concat(j,"/mfa/verify-totp?user_id=").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({totp_code:v})})).ok&&(c("complete"),r())}catch(e){console.error("TOTP検証エラー:",e)}finally{y(!1)}};return"setup"===o?(0,a.jsxs)(l.Zp,{className:"w-full max-w-md mx-auto",children:[(0,a.jsx)(l.aR,{children:(0,a.jsx)(l.ZB,{children:"MFA設定"})}),(0,a.jsx)(l.Wu,{children:(0,a.jsx)("div",{className:"text-center",children:b?(0,a.jsx)("div",{children:"MFAを設定中..."}):(0,a.jsx)(s.$,{onClick:()=>w(),children:"MFA設定を開始"})})})]}):"verify"===o?(0,a.jsxs)(l.Zp,{className:"w-full max-w-md mx-auto",children:[(0,a.jsx)(l.aR,{children:(0,a.jsx)(l.ZB,{children:"Authenticatorアプリに追加"})}),(0,a.jsxs)(l.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("img",{src:d,alt:"QR Code",className:"mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"上記のQRコードをGoogle Authenticatorなどのアプリでスキャンしてください"}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mb-4",children:["または、手動で秘密鍵を入力: ",(0,a.jsx)("code",{className:"bg-gray-100 px-2 py-1 rounded",children:f})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m,{htmlFor:"totp",children:"TOTPコード"}),(0,a.jsx)(i,{id:"totp",type:"text",placeholder:"6桁のコードを入力",value:v,onChange:e=>g(e.target.value),maxLength:6})]}),(0,a.jsx)(s.$,{onClick:N,disabled:6!==v.length||b,className:"w-full",children:b?"検証中...":"検証"}),(0,a.jsxs)("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded",children:[(0,a.jsx)("h4",{className:"font-medium text-yellow-800 mb-2",children:"バックアップコード"}),(0,a.jsx)("p",{className:"text-sm text-yellow-700 mb-2",children:"以下のコードを安全な場所に保管してください："}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:x.map((e,t)=>(0,a.jsx)("code",{className:"bg-white px-2 py-1 rounded border",children:e},t))})]})]})]}):"complete"===o?(0,a.jsxs)(l.Zp,{className:"w-full max-w-md mx-auto",children:[(0,a.jsx)(l.aR,{children:(0,a.jsx)(l.ZB,{children:"MFA設定完了！"})}),(0,a.jsx)(l.Wu,{children:(0,a.jsxs)("div",{className:"text-center text-green-600",children:[(0,a.jsx)("p",{children:"MFAが正常に設定されました。"}),(0,a.jsx)("p",{className:"text-sm mt-2",children:"次回ログイン時からMFA認証が必要になります。"})]})})]}):null}function h(){return(0,a.jsxs)("div",{className:"container mx-auto py-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"MFA設定テスト"}),(0,a.jsx)(x,{userId:"581c56f8-6885-467d-a113-ffbbe65cd184",onComplete:()=>{console.log("MFA設定完了！")}})]})}m.displayName=d.displayName},2085:(e,t,r)=>{"use strict";r.d(t,{F:()=>l});var a=r(2596);let n=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,s=a.$,l=(e,t)=>r=>{var a;if((null==t?void 0:t.variants)==null)return s(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:l,defaultVariants:i}=t,o=Object.keys(l).map(e=>{let t=null==r?void 0:r[e],a=null==i?void 0:i[e];if(null===t)return null;let s=n(t)||n(a);return l[e][s]}),c=r&&Object.entries(r).reduce((e,t)=>{let[r,a]=t;return void 0===a||(e[r]=a),e},{});return s(e,o,null==t||null==(a=t.compoundVariants)?void 0:a.reduce((e,t)=>{let{class:r,className:a,...n}=t;return Object.entries(n).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...i,...c}[t]):({...i,...c})[t]===r})?[...e,r,a]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)}},4624:(e,t,r)=>{"use strict";r.d(t,{DX:()=>i,TL:()=>l});var a=r(2115);function n(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}var s=r(5155);function l(e){let t=function(e){let t=a.forwardRef((e,t)=>{let{children:r,...s}=e;if(a.isValidElement(r)){var l;let e,i,o=(l=r,(i=(e=Object.getOwnPropertyDescriptor(l.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?l.ref:(i=(e=Object.getOwnPropertyDescriptor(l,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?l.props.ref:l.props.ref||l.ref),c=function(e,t){let r={...t};for(let a in t){let n=e[a],s=t[a];/^on[A-Z]/.test(a)?n&&s?r[a]=(...e)=>{let t=s(...e);return n(...e),t}:n&&(r[a]=n):"style"===a?r[a]={...n,...s}:"className"===a&&(r[a]=[n,s].filter(Boolean).join(" "))}return{...e,...r}}(s,r.props);return r.type!==a.Fragment&&(c.ref=t?function(...e){return t=>{let r=!1,a=e.map(e=>{let a=n(e,t);return r||"function"!=typeof a||(r=!0),a});if(r)return()=>{for(let t=0;t<a.length;t++){let r=a[t];"function"==typeof r?r():n(e[t],null)}}}}(t,o):o),a.cloneElement(r,c)}return a.Children.count(r)>1?a.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}(e),r=a.forwardRef((e,r)=>{let{children:n,...l}=e,i=a.Children.toArray(n),o=i.find(c);if(o){let e=o.props.children,n=i.map(t=>t!==o?t:a.Children.count(e)>1?a.Children.only(null):a.isValidElement(e)?e.props.children:null);return(0,s.jsx)(t,{...l,ref:r,children:a.isValidElement(e)?a.cloneElement(e,void 0,n):null})}return(0,s.jsx)(t,{...l,ref:r,children:n})});return r.displayName=`${e}.Slot`,r}var i=l("Slot"),o=Symbol("radix.slottable");function c(e){return a.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===o}},6695:(e,t,r)=>{"use strict";r.d(t,{Wu:()=>o,ZB:()=>i,Zp:()=>s,aR:()=>l});var a=r(5155);r(2115);var n=r(9434);function s(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card",className:(0,n.cn)("bg-card text-card-foreground flex flex-col gap-3 rounded-xl border py-3 shadow-sm",t),...r})}function l(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,n.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-3",t),...r})}function i(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,n.cn)("leading-none font-semibold",t),...r})}function o(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,n.cn)("px-6",t),...r})}},7022:(e,t,r)=>{Promise.resolve().then(r.bind(r,503))},9434:(e,t,r)=>{"use strict";r.d(t,{cn:()=>s});var a=r(2596),n=r(9688);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.QP)((0,a.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[277,441,684,358],()=>t(7022)),_N_E=e.O()}]);